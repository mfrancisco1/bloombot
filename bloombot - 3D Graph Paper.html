<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Graph Paper — bloombot</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --ink:#1a1612;--cream:#f5f0e8;--warm:#e8dcc8;
      --rust:#c4541a;--amber:#d97706;--forest:#2d5a27;
      --slate:#64748b;--border:#d1c4aa;--shadow:rgba(26,22,18,0.10);
      --c341:#b45309;
    }
    html{scroll-behavior:smooth;}
    body{font-family:'Space Grotesk',sans-serif;background:var(--cream);color:var(--ink);line-height:1.6;}

    /* ── NAV ── */
    nav{position:sticky;top:0;z-index:100;background:var(--ink);display:flex;align-items:center;justify-content:space-between;padding:0 2rem;height:56px;border-bottom:3px solid var(--rust);}
    .nav-brand{font-family:'Space Mono',monospace;font-size:1.2rem;font-weight:700;color:var(--amber);text-decoration:none;letter-spacing:-0.03em;}
    .nav-links{display:flex;list-style:none;overflow:visible;}
    .nav-links li{position:relative;}
    .nav-links li>a{display:flex;align-items:center;gap:0.3rem;height:56px;padding:0 0.9rem;color:rgba(255,255,255,0.65);text-decoration:none;font-size:0.78rem;font-weight:500;letter-spacing:0.04em;text-transform:uppercase;white-space:nowrap;transition:color 0.2s,background 0.2s;}
    .nav-links li>a:hover{color:#fff;background:rgba(255,255,255,0.07);}
    .nav-links li>a.active{color:var(--amber);}
    .caret{font-size:0.55rem;opacity:0.5;}
    .dropdown{display:none;position:absolute;top:56px;left:0;background:#111;border:1px solid rgba(255,255,255,0.1);border-top:2px solid var(--rust);border-radius:0 0 8px 8px;min-width:200px;list-style:none;z-index:200;box-shadow:0 8px 24px rgba(0,0,0,0.4);}
    .nav-links li:hover .dropdown{display:block;}
    .dropdown li a{display:block;padding:0.6rem 1rem;font-size:0.78rem;color:rgba(255,255,255,0.65);border-bottom:1px solid rgba(255,255,255,0.06);white-space:nowrap;text-decoration:none;}
    .dropdown li:last-child a{border-bottom:none;}
    .dropdown li a:hover{color:#fff;background:rgba(255,255,255,0.07);}

    /* ── HERO ── */
    .page-hero{background:var(--c341);color:#fff;padding:3.5rem 2rem 3rem;position:relative;overflow:hidden;}
    .page-hero::before{content:'';position:absolute;inset:0;pointer-events:none;background:repeating-linear-gradient(0deg,transparent,transparent 39px,rgba(255,255,255,0.04) 39px,rgba(255,255,255,0.04) 40px),repeating-linear-gradient(90deg,transparent,transparent 39px,rgba(255,255,255,0.04) 39px,rgba(255,255,255,0.04) 40px);}
    .page-hero-inner{max-width:1100px;margin:0 auto;position:relative;}
    .breadcrumb{font-family:'Space Mono',monospace;font-size:0.7rem;letter-spacing:0.14em;text-transform:uppercase;color:rgba(255,255,255,0.5);margin-bottom:0.75rem;}
    .breadcrumb a{color:rgba(255,255,255,0.4);text-decoration:none;}
    .breadcrumb a:hover{color:rgba(255,255,255,0.8);}
    .page-title{font-size:clamp(2rem,5vw,3.5rem);font-weight:700;letter-spacing:-0.04em;line-height:1.05;margin-bottom:0.75rem;}
    .page-desc{font-size:1rem;color:rgba(255,255,255,0.7);max-width:620px;line-height:1.75;}

    /* ── PAGE LAYOUT ── */
    .section{max-width:1100px;margin:0 auto;padding:3rem 2rem;}
    .section-label{font-family:'Space Mono',monospace;font-size:0.68rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--slate);margin-bottom:1.25rem;display:flex;align-items:center;gap:0.5rem;}
    .section-label::after{content:'';flex:1;height:1px;background:var(--border);max-width:60px;}

    /* ── CONTEXT NOTE ── */
    .context-note{background:#fff;border:1.5px solid var(--border);border-left:4px solid var(--c341);border-radius:8px;padding:1.25rem 1.5rem;max-width:820px;margin-bottom:2.5rem;}
    .context-note p{font-size:0.92rem;color:var(--ink);line-height:1.75;margin-bottom:0.75rem;}
    .context-note p:last-child{margin-bottom:0;}

    /* ── GENERATOR LAYOUT ── */
    .generator{display:grid;grid-template-columns:300px 1fr;gap:2rem;align-items:start;}

    /* ── CONTROLS PANEL ── */
    .controls-panel{background:#fff;border:1.5px solid var(--border);border-radius:12px;padding:1.5rem;position:sticky;top:72px;}
    .ctrl-section-head{font-family:'Space Mono',monospace;font-size:0.68rem;letter-spacing:0.14em;text-transform:uppercase;color:var(--c341);font-weight:700;margin:1.25rem 0 0.75rem;padding-top:1rem;border-top:1px solid var(--border);}
    .ctrl-section-head:first-child{margin-top:0;padding-top:0;border-top:none;}
    .ctrl-group{margin-bottom:1rem;}
    .ctrl-group label{display:block;font-size:0.78rem;font-weight:600;color:var(--ink);margin-bottom:0.3rem;letter-spacing:0.01em;}
    .ctrl-group input[type="number"]{width:100%;padding:0.45rem 0.6rem;border:1.5px solid var(--border);border-radius:6px;font-family:'Space Grotesk',sans-serif;font-size:0.85rem;color:var(--ink);background:var(--cream);transition:border-color 0.15s;}
    .ctrl-group input[type="number"]:focus{outline:none;border-color:var(--c341);}
    .ctrl-group input[type="checkbox"]{accent-color:var(--c341);width:14px;height:14px;margin-right:0.4rem;vertical-align:middle;}
    .unit-hint{font-family:'Space Mono',monospace;font-size:0.65rem;color:var(--slate);margin-top:0.2rem;}
    .notch-hint{font-size:0.72rem;color:var(--slate);margin-top:0.3rem;background:var(--warm);padding:0.3rem 0.5rem;border-radius:4px;}
    .side-b-controls{display:none;}
    .side-b-controls.active{display:block;}

    /* ── EXPORT BUTTONS ── */
    .export-group{display:flex;flex-direction:column;gap:0.6rem;margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--border);}
    .export-btn{background:var(--c341);color:#fff;border:none;padding:0.6rem 1rem;border-radius:6px;font-family:'Space Grotesk',sans-serif;font-size:0.8rem;font-weight:600;cursor:pointer;letter-spacing:0.02em;transition:background 0.15s;}
    .export-btn:hover{background:var(--rust);}

    /* ── SVG OUTPUT ── */
    .output-panel{display:flex;flex-direction:column;gap:1.5rem;}
    .svg-wrap{background:#fff;border:1.5px solid var(--border);border-radius:12px;padding:1.25rem;display:flex;justify-content:center;align-items:center;min-height:260px;}
    .svg-wrap svg{max-width:100%;height:auto;}
    .svg-label{font-family:'Space Mono',monospace;font-size:0.65rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--slate);margin-bottom:0.6rem;}
    .top-view-wrap{background:#fff;border:1.5px solid var(--border);border-radius:12px;padding:1.25rem;cursor:zoom-in;}
    .top-view-wrap:hover{border-color:var(--c341);}
    .top-view-wrap svg{max-width:100%;height:auto;display:block;}
    .top-hint{font-size:0.72rem;color:var(--slate);margin-top:0.5rem;font-style:italic;}

    /* ── MODAL ── */
    .modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.75);justify-content:center;align-items:center;}
    .modal-inner{background:#fff;padding:1.5rem;border-radius:12px;max-width:90vw;max-height:90vh;overflow:auto;position:relative;}
    .modal-close{position:absolute;top:0.75rem;right:1rem;font-size:1.5rem;font-weight:700;cursor:pointer;color:var(--slate);line-height:1;}
    .modal-close:hover{color:var(--ink);}
    #modalSvgContainer svg{width:100%;height:auto;}

    /* ── FOOTER ── */
    footer{background:var(--ink);color:rgba(255,255,255,0.4);text-align:center;padding:2.5rem 2rem;font-family:'Space Mono',monospace;font-size:0.72rem;letter-spacing:0.06em;line-height:2;margin-top:4rem;}
    footer a{color:var(--amber);text-decoration:none;}

    /* ── GALLERY ── */
    .gallery-section{background:var(--ink);padding:3rem 2rem;margin-top:3rem;}
    .gallery-inner{max-width:1100px;margin:0 auto;}
    .gallery-label{font-family:'Space Mono',monospace;font-size:0.68rem;letter-spacing:0.2em;text-transform:uppercase;color:rgba(255,255,255,0.35);margin-bottom:1.25rem;display:flex;align-items:center;gap:0.5rem;}
    .gallery-label::after{content:'';flex:1;height:1px;background:rgba(255,255,255,0.1);max-width:60px;}
    .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1rem;}
    .gallery-item{border-radius:10px;overflow:hidden;border:1.5px solid rgba(255,255,255,0.08);}
    .gallery-item img{width:100%;height:260px;object-fit:cover;display:block;transition:transform 0.3s;}
    .gallery-item:hover img{transform:scale(1.03);}
    .gallery-caption{padding:0.6rem 0.85rem;background:rgba(255,255,255,0.04);font-size:0.75rem;color:rgba(255,255,255,0.45);font-family:'Space Mono',monospace;}

    @media(max-width:780px){.generator{grid-template-columns:1fr;}.controls-panel{position:static;}.nav-links{display:none;}}
  </style>
</head>
<body>

<nav>
  <a class="nav-brand" href="bloombot-modern.html">bloombot</a>
  <ul class="nav-links">
    <li>
      <a href="bloombot-i101.html">I 101 <span class="caret">▼</span></a>
      <ul class="dropdown">
        <li><a href="bloombot-i101.html#networks">Networks</a></li>
        <li><a href="bloombot-i101.html#ethics">Ethics</a></li>
        <li><a href="bloombot-i101.html#security">Security</a></li>
        <li><a href="bloombot-i101.html#diversity">Diversity</a></li>
        <li><a href="bloombot-i101.html#design">Design</a></li>
        <li><a href="bloombot-i101.html#data">Data</a></li>
      </ul>
    </li>
    <li>
      <a href="bloombot-stories.html">Stories <span class="caret">▼</span></a>
      <ul class="dropdown">
        <li><a href="bloombot - Lightning.html">Lightning</a></li>
        <li><a href="bloombot - Coffee.html">Coffee</a></li>
      </ul>
    </li>
    <li>
      <a href="bloombot-prototyping.html" class="active">Prototyping <span class="caret">▼</span></a>
      <ul class="dropdown">
        <li><a href="bloombot - 3D Graph Paper.html">3D Graph Paper</a></li>
        <li><a href="bloombot - Lattice.html">Lattice</a></li>
        <li><a href="bloombot - Encoder Wheel.html">Encoder Wheel</a></li>
        <li><a href="webpage-main/stlM2.html">3D Model Viewer</a></li>
      </ul>
    </li>
    <li><a href="bloombot-scaffolds.html">Scaffolds</a></li>
  </ul>
</nav>

<header class="page-hero">
  <div class="page-hero-inner">
    <p class="breadcrumb"><a href="bloombot-modern.html">bloombot</a> / <a href="bloombot-prototyping.html">Prototyping</a> / 3D Graph Paper</p>
    <h1 class="page-title">3D Graph Paper</h1>
    <p class="page-desc">A generator for torsion box sections — interlocking paper strips that become rigid structural panels when skinned. Used in I 341 for robotic prototyping.</p>
  </div>
</header>

<div class="section">

  <div class="context-note">
    <p><strong>About the Torsion Box Structure:</strong> 3D graph paper becomes very strong once a skin or panel is glued to the grid. This is called a <em>torsion box</em> — a common pattern for creating strong, dead-flat work surfaces in woodworking. Torsion boxes made from paper make excellent materials in robotic prototypes: rigid, easy to shape, and reliable mounting surfaces for electronics, sensors, motors, and wiring.</p>
    <p>A second variation uses two different section sizes that form rectangular "bays" — especially useful for modular designs or where different components need distinct mounting spaces.</p>
  </div>

  <p class="section-label">Generator</p>

  <div class="generator">

    <!-- CONTROLS -->
    <div class="controls-panel">

      <div class="ctrl-section-head">Side A Parameters</div>

      <div class="ctrl-group">
        <label for="width">Total Width (mm)</label>
        <input type="number" id="width" value="147.1" min="35" max="353" step="0.1">
        <div class="unit-hint" id="widthUnits">≈ 417 units</div>
      </div>
      <div class="ctrl-group">
        <label for="numNotches">Number of Notches</label>
        <input type="number" id="numNotches" value="12" min="1" max="50">
      </div>
      <div class="ctrl-group">
        <label for="offset">Edge Offset (mm)</label>
        <input type="number" id="offset" value="2.47" min="0" max="35.3" step="0.01">
        <div class="unit-hint" id="offsetUnits">≈ 7 units</div>
      </div>
      <div class="ctrl-group">
        <label><input type="checkbox" id="dualSection"> Add Side B (Rectangle Bay)</label>
      </div>

      <div class="side-b-controls" id="sideBControls">
        <div class="ctrl-section-head">Side B Parameters</div>
        <div class="ctrl-group">
          <label for="widthB">Total Width (mm)</label>
          <input type="number" id="widthB" value="147.1" min="35" max="353" step="0.1">
          <div class="unit-hint" id="widthBUnits">≈ 417 units</div>
        </div>
        <div class="ctrl-group">
          <label for="numNotchesB">Number of Notches</label>
          <input type="number" id="numNotchesB" value="12" min="1" max="50">
        </div>
        <div class="ctrl-group">
          <label for="offsetB">Edge Offset (mm)</label>
          <input type="number" id="offsetB" value="2.47" min="0" max="35.3" step="0.01">
          <div class="unit-hint" id="offsetBUnits">≈ 7 units</div>
        </div>
      </div>

      <div class="ctrl-section-head">Structure (shared)</div>

      <div class="ctrl-group">
        <label for="height">Total Height (mm)</label>
        <input type="number" id="height" value="12.0" min="3.5" max="70.6" step="0.1">
        <div class="unit-hint" id="heightUnits">≈ 34 units</div>
      </div>
      <div class="ctrl-group">
        <label for="notchWidth">Notch Width / Paper Thickness (mm)</label>
        <input type="number" id="notchWidth" value="0.46" min="0.18" max="7.06" step="0.01">
        <div class="unit-hint" id="notchWidthUnits">≈ 1.3 units</div>
      </div>
      <div class="ctrl-group">
        <label for="notchDepth">Notch Depth for Side A (% of height)</label>
        <input type="number" id="notchDepth" value="50" min="10" max="90">
        <div class="unit-hint" id="notchDepthMm">≈ 6.0mm</div>
        <div class="notch-hint" id="notchInfo">Side B will have complementary depth: 50%</div>
      </div>

      <div class="export-group">
        <button class="export-btn" onclick="exportSVG()">Export as SVG</button>
        <button class="export-btn" onclick="exportIllustrator()">Export for Illustrator</button>
      </div>
    </div><!-- /controls-panel -->

    <!-- OUTPUT -->
    <div class="output-panel">
      <div>
        <p class="svg-label">Section Profile</p>
        <div class="svg-wrap">
          <svg id="shapeSvg" width="400" height="1000" viewBox="0 0 134 516.7833333333333" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
            <g id="rotatedGroup" transform="rotate(90) translate(0 -134)">
              <polygon id="shapePolygon" style="fill:var(--cream);stroke:var(--c341);stroke-width:2;" points=""/>
              <polygon id="shapePolygon2" style="fill:var(--cream);stroke:var(--c341);stroke-width:2;" points=""/>
            </g>
          </svg>
        </div>
      </div>
      <div>
        <p class="svg-label">Top View — click to enlarge</p>
        <div class="top-view-wrap" id="topViewWrap">
          <svg id="topViewSvg" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"></svg>
        </div>
        <p class="top-hint">Click the top view to open it full size.</p>
      </div>
    </div><!-- /output-panel -->

  </div><!-- /generator -->
</div><!-- /section -->

<!-- MODAL -->
<div id="svgModal" class="modal">
  <div class="modal-inner">
    <span class="modal-close" id="closeModal">×</span>
    <div id="modalSvgContainer"></div>
  </div>
</div>

<div class="gallery-section">
  <div class="gallery-inner">
    <p class="gallery-label">In Practice</p>
    <div class="gallery-grid">
      <div class="gallery-item">
        <img src="bloombot - 3D Graph Paper_files/unnamed.jpg" alt="Torsion box structures made from paper strips, with a small mouse figure for scale">
        <p class="gallery-caption">Paper torsion box prototypes — I 341</p>
      </div>
    </div>
  </div>
</div>

<footer>
  <div>bloombot &nbsp;·&nbsp; Matthew Francisco &nbsp;·&nbsp; Luddy School of Informatics, Computing &amp; Engineering</div>
  <div>Indiana University &nbsp;·&nbsp; <a href="bloombot-modern.html">Home</a></div>
</footer>

<script>
  const MM_TO_UNITS = 34 / 12;
  const UNITS_TO_MM = 12 / 34;
  function mmToUnits(mm) { return mm * MM_TO_UNITS; }

  function updateUnitDisplays() {
    const widthMm = parseFloat(document.getElementById('width').value);
    const heightMm = parseFloat(document.getElementById('height').value);
    const notchWidthMm = parseFloat(document.getElementById('notchWidth').value);
    const offsetMm = parseFloat(document.getElementById('offset').value);
    const notchDepthPercent = parseFloat(document.getElementById('notchDepth').value);
    const dualSection = document.getElementById('dualSection').checked;
    document.getElementById('widthUnits').textContent = `≈ ${mmToUnits(widthMm).toFixed(0)} units`;
    document.getElementById('heightUnits').textContent = `≈ ${mmToUnits(heightMm).toFixed(0)} units`;
    document.getElementById('notchWidthUnits').textContent = `≈ ${mmToUnits(notchWidthMm).toFixed(1)} units`;
    document.getElementById('offsetUnits').textContent = `≈ ${mmToUnits(offsetMm).toFixed(0)} units`;
    const notchDepthMm = heightMm * (notchDepthPercent / 100);
    document.getElementById('notchDepthMm').textContent = `≈ ${notchDepthMm.toFixed(1)}mm`;
    const complementaryDepth = 100 - notchDepthPercent;
    document.getElementById('notchInfo').textContent = `Side B will have complementary depth: ${complementaryDepth}%`;
    if (dualSection) {
      const widthBMm = parseFloat(document.getElementById('widthB').value);
      const offsetBMm = parseFloat(document.getElementById('offsetB').value);
      document.getElementById('widthBUnits').textContent = `≈ ${mmToUnits(widthBMm).toFixed(0)} units`;
      document.getElementById('offsetBUnits').textContent = `≈ ${mmToUnits(offsetBMm).toFixed(0)} units`;
    }
  }

  function generateShape() {
    const widthMm = parseFloat(document.getElementById('width').value);
    const heightMm = parseFloat(document.getElementById('height').value);
    const numNotches = parseInt(document.getElementById('numNotches').value);
    const notchWidthMm = parseFloat(document.getElementById('notchWidth').value);
    const offsetMm = parseFloat(document.getElementById('offset').value);
    const notchDepthPercent = parseFloat(document.getElementById('notchDepth').value);
    const dualSection = document.getElementById('dualSection').checked;
    const width = mmToUnits(widthMm);
    const height = mmToUnits(heightMm);
    const notchWidth = mmToUnits(notchWidthMm);
    const offset = mmToUnits(offsetMm);
    const notchDepthA = height * (notchDepthPercent / 100);
    const startX = 50, startY = 50;

    function buildPoints(useWidth, useNumNotches, useOffset, useNotchDepth, yOffset=0) {
      const usableLength = useWidth - 2 * useOffset - notchWidth;
      const spacing = useNumNotches > 1 ? usableLength / (useNumNotches - 1) : 0;
      let pts = [];
      pts.push([startX, startY + yOffset]);
      pts.push([startX + useWidth, startY + yOffset]);
      pts.push([startX + useWidth, startY + height + yOffset]);
      for (let i = useNumNotches - 1; i >= 0; i--) {
        const notchStartX = startX + useOffset + i * spacing;
        const notchEndX = notchStartX + notchWidth;
        pts.push([notchEndX, startY + height + yOffset]);
        pts.push([notchEndX, startY + height - useNotchDepth + yOffset]);
        pts.push([notchStartX, startY + height - useNotchDepth + yOffset]);
        pts.push([notchStartX, startY + height + yOffset]);
      }
      pts.push([startX, startY + height + yOffset]);
      return pts.map(p => `${p[0]},${p[1]}`).join(' ');
    }

    document.getElementById('shapePolygon').setAttribute('points', buildPoints(width, numNotches, offset, notchDepthA, 0));
    if (dualSection) {
      const widthBMm = parseFloat(document.getElementById('widthB').value);
      const numNotchesB = parseInt(document.getElementById('numNotchesB').value);
      const offsetBMm = parseFloat(document.getElementById('offsetB').value);
      const widthB = mmToUnits(widthBMm);
      const offsetB = mmToUnits(offsetBMm);
      const notchDepthB = height * ((100 - notchDepthPercent) / 100);
      document.getElementById('shapePolygon2').setAttribute('points', buildPoints(widthB, numNotchesB, offsetB, notchDepthB, height + 20));
    } else {
      document.getElementById('shapePolygon2').setAttribute('points', '');
    }
    const maxWidth = dualSection ? Math.max(width, mmToUnits(parseFloat(document.getElementById('widthB').value))) : width;
    const viewBoxHeight = maxWidth + 100;
    const viewBoxWidth = dualSection ? (height * 2 + 150) : (height + 100);
    document.getElementById('shapeSvg').setAttribute('viewBox', `0 0 ${viewBoxWidth} ${viewBoxHeight}`);
    updateUnitDisplays();
  }

  function rotateSvg() {
    const svg = document.getElementById('shapeSvg');
    const vb = svg.viewBox.baseVal;
    document.getElementById('rotatedGroup').setAttribute('transform', `rotate(90) translate(0 -${vb.width})`);
  }

  function generateTopView() {
    const dualSection = document.getElementById('dualSection').checked;
    const widthAMm = parseFloat(document.getElementById('width').value);
    const numNotchesA = parseInt(document.getElementById('numNotches').value);
    const offsetAMm = parseFloat(document.getElementById('offset').value);
    let widthBMm = widthAMm, numNotchesB = numNotchesA, offsetBMm = offsetAMm;
    if (dualSection) {
      widthBMm = parseFloat(document.getElementById('widthB').value);
      numNotchesB = parseInt(document.getElementById('numNotchesB').value);
      offsetBMm = parseFloat(document.getElementById('offsetB').value);
    }
    const notchWidthMm = parseFloat(document.getElementById('notchWidth').value);
    const widthA = mmToUnits(widthAMm);
    const widthB = mmToUnits(widthBMm);
    const offsetA = mmToUnits(offsetAMm);
    const offsetB = mmToUnits(offsetBMm);
    const notchWidth = mmToUnits(notchWidthMm);
    const gridWidth = widthA - 2 * offsetA;
    const gridHeight = widthB - 2 * offsetB;
    const svg = document.getElementById('topViewSvg');
    svg.innerHTML = '';
    const margin = 30;
    const outer = document.createElementNS('http://www.w3.org/2000/svg','rect');
    outer.setAttribute('x', margin); outer.setAttribute('y', margin);
    outer.setAttribute('width', widthA); outer.setAttribute('height', widthB);
    outer.setAttribute('fill','none'); outer.setAttribute('stroke','#1a1612');
    outer.setAttribute('stroke-dasharray','4,3');
    svg.appendChild(outer);
    if (numNotchesA > 0) {
      const usableA = gridWidth - notchWidth;
      const spacingA = numNotchesA > 1 ? usableA / (numNotchesA - 1) : 0;
      for (let i = 0; i < numNotchesA; i++) {
        const x = margin + offsetA + i * spacingA;
        const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x', x); rect.setAttribute('y', margin);
        rect.setAttribute('width', notchWidth); rect.setAttribute('height', widthB);
        rect.setAttribute('fill','#e8dcc8'); rect.setAttribute('stroke','#b45309');
        svg.appendChild(rect);
      }
    }
    if (numNotchesB > 0) {
      const usableB = gridHeight - notchWidth;
      const spacingB = numNotchesB > 1 ? usableB / (numNotchesB - 1) : 0;
      for (let j = 0; j < numNotchesB; j++) {
        const y = margin + offsetB + j * spacingB;
        const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x', margin); rect.setAttribute('y', y);
        rect.setAttribute('width', widthA); rect.setAttribute('height', notchWidth);
        rect.setAttribute('fill','#f5f0e8'); rect.setAttribute('stroke','#d97706');
        svg.appendChild(rect);
      }
    }
    svg.setAttribute('viewBox', `0 0 ${widthA + 2*margin} ${widthB + 2*margin}`);
    function addText(txt, x, y, opts={}) {
      const t = document.createElementNS('http://www.w3.org/2000/svg','text');
      t.setAttribute('x', x); t.setAttribute('y', y);
      t.setAttribute('font-size','12'); t.setAttribute('fill','#1a1612');
      t.setAttribute('font-family','Space Mono, monospace');
      if (opts.anchor) t.setAttribute('text-anchor', opts.anchor);
      if (opts.transform) t.setAttribute('transform', opts.transform);
      t.textContent = txt;
      svg.appendChild(t);
    }
    // A label: centred above top edge
    addText(`A: ${widthAMm.toFixed(1)} mm`, margin + widthA/2, margin - 10, { anchor: 'middle' });
    // B label: rotated on right side
    addText(`B: ${widthBMm.toFixed(1)} mm`, margin + widthA + 14, margin + widthB/2,
      { anchor: 'middle', transform: `rotate(-90, ${margin + widthA + 14}, ${margin + widthB/2})` });
    // Bay A label: centred below bottom edge
    if (numNotchesA > 1) addText(`Bay A: ${((widthAMm - 2*offsetAMm - notchWidthMm)/(numNotchesA-1)).toFixed(2)} mm`, margin + widthA/2, margin + widthB + 20, { anchor: 'middle' });
    // Bay B label: rotated on left side
    if (numNotchesB > 1) addText(`Bay B: ${((widthBMm - 2*offsetBMm - notchWidthMm)/(numNotchesB-1)).toFixed(2)} mm`, margin - 14, margin + widthB/2,
      { anchor: 'middle', transform: `rotate(-90, ${margin - 14}, ${margin + widthB/2})` });
  }

  const oldGenerateShape = generateShape;
  generateShape = function() { oldGenerateShape(); generateTopView(); };

  function exportSVG() {
    const svg = document.getElementById('shapeSvg');
    let svgString = '<?xml version="1.0" encoding="UTF-8"?>\n' + new XMLSerializer().serializeToString(svg);
    const a = Object.assign(document.createElement('a'), {href: URL.createObjectURL(new Blob([svgString],{type:'image/svg+xml'})), download:'torsion_box_section.svg'});
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
  }

  function exportIllustrator() {
    const svg = document.getElementById('shapeSvg');
    let svgString = '<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n' + new XMLSerializer().serializeToString(svg);
    const a = Object.assign(document.createElement('a'), {href: URL.createObjectURL(new Blob([svgString],{type:'image/svg+xml'})), download:'torsion_box_illustrator.svg'});
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
  }

  // Modal
  document.getElementById('topViewWrap').addEventListener('click', () => {
    const container = document.getElementById('modalSvgContainer');
    container.innerHTML = '';
    const clone = document.getElementById('topViewSvg').cloneNode(true);
    clone.removeAttribute('width'); clone.removeAttribute('height');
    container.appendChild(clone);
    document.getElementById('svgModal').style.display = 'flex';
  });
  document.getElementById('closeModal').addEventListener('click', () => { document.getElementById('svgModal').style.display = 'none'; });
  document.getElementById('svgModal').addEventListener('click', (e) => { if (e.target.id === 'svgModal') document.getElementById('svgModal').style.display = 'none'; });

  // Side B toggle
  document.getElementById('dualSection').addEventListener('change', function() {
    document.getElementById('sideBControls').classList.toggle('active', this.checked);
    generateShape(); rotateSvg();
  });

  // Live updates
  document.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', generateShape);
    input.addEventListener('change', generateShape);
  });

  generateShape();
  rotateSvg();
</script>
</body>
</html>
