<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informatics Learning Outcomes — bloombot</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        :root {
            --ink:     #1a1612;
            --cream:   #f5f0e8;
            --warm:    #e8dcc8;
            --rust:    #c4541a;
            --amber:   #d97706;
            --forest:  #2d5a27;
            --slate:   #64748b;
            --border:  #d1c4aa;
        }

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--ink);
            min-height: 100vh;
            overflow: hidden;
            color: var(--cream);
        }

        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: var(--ink);
            padding: 12px 20px;
            border-bottom: 3px solid var(--rust);
            z-index: 100;
            display: flex;
            align-items: baseline;
            gap: 16px;
        }

        #header h1 {
            font-family: 'Space Mono', monospace;
            font-size: 18px;
            color: var(--amber);
            font-weight: 700;
            letter-spacing: -0.03em;
        }

        #subtitle {
            font-size: 13px;
            color: rgba(245,240,232,0.5);
            font-weight: 400;
        }

        svg {
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        svg.dragging {
            cursor: grabbing;
        }

        .link {
            stroke: rgba(245,240,232,0.15);
            stroke-width: 1.5;
            stroke-opacity: 1;
            fill: none;
        }

        .link.active {
            stroke: var(--amber);
            stroke-width: 2;
            stroke-opacity: 1;
        }

        .node {
            cursor: pointer;
            stroke: rgba(26,22,18,0.6);
            stroke-width: 2;
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.4));
            transition: filter 0.3s ease;
        }

        .node:hover {
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.5));
        }

        .node.pinned {
            stroke: var(--amber);
            stroke-width: 3;
        }

        .node.expanded {
            stroke: var(--rust);
            stroke-width: 3;
        }

        .node-text {
            fill: #fff;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
            font-size: 12px;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
            text-shadow: 0 1px 2px rgba(0,0,0,0.4);
        }

        .outcome-node {
            fill: rgba(245,240,232,0.08);
            stroke-width: 1;
            rx: 6;
            ry: 6;
            filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.3));
        }

        .outcome-text {
            fill: var(--cream);
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 400;
            font-size: 10px;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
        }

        .expand-indicator {
            fill: #fff;
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
        }

        #tooltip {
            position: absolute;
            background: var(--cream);
            color: var(--ink);
            padding: 10px 14px;
            border-radius: 6px;
            border: 1px solid var(--border);
            font-family: 'Space Grotesk', sans-serif;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 300px;
            z-index: 1000;
            line-height: 1.5;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        }

        #tooltip.show {
            opacity: 1;
        }

        #tooltip strong {
            color: var(--rust);
            display: block;
            margin-bottom: 4px;
            font-size: 13px;
            font-weight: 600;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            z-index: 100;
        }

        .control-btn {
            padding: 6px 14px;
            border: 1px solid rgba(245,240,232,0.2);
            background: rgba(26,22,18,0.8);
            color: var(--cream);
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.02em;
            transition: all 0.2s;
            backdrop-filter: blur(8px);
        }

        .control-btn:hover {
            background: var(--rust);
            border-color: var(--rust);
            color: white;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(26,22,18,0.85);
            border: 1px solid rgba(245,240,232,0.12);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 11px;
            z-index: 100;
            backdrop-filter: blur(8px);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            color: rgba(245,240,232,0.7);
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid rgba(0,0,0,0.3);
        }

        .instructions {
            position: absolute;
            top: 60px;
            right: 20px;
            background: rgba(26,22,18,0.85);
            border: 1px solid rgba(245,240,232,0.12);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 11px;
            z-index: 100;
            max-width: 220px;
            backdrop-filter: blur(8px);
        }

        .instructions h3 {
            margin-bottom: 8px;
            color: var(--amber);
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.06em;
            text-transform: uppercase;
        }

        .instructions ul {
            list-style: none;
            padding: 0;
        }

        .instructions li {
            margin-bottom: 4px;
            color: rgba(245,240,232,0.55);
            font-size: 11px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="header">
            <h1>Informatics Learning Outcomes</h1>
            <div id="subtitle">Interactive Spring Simulation - First Three Pillars</div>
        </div>
        
        <div class="instructions">
            <h3>Controls</h3>
            <ul>
                <li>• Click nodes to expand/collapse</li>
                <li>• Drag nodes to pin/unpin</li>
                <li>• Hover for full descriptions</li>
                <li>• Pinned nodes stay in place</li>
            </ul>
        </div>
        
        <svg id="svg"></svg>
        
        <div class="controls">
            <button class="control-btn" onclick="resetSimulation()">Reset</button>
            <button class="control-btn" onclick="unpinAll()">Unpin All</button>
            <button class="control-btn" onclick="expandAll()">Expand All</button>
            <button class="control-btn" onclick="collapseAll()">Collapse All</button>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #c4541a;"></div>
                <span>Computational</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #2d5a27;"></div>
                <span>Sociotechnical</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #1d4ed8;"></div>
                <span>Design</span>
            </div>
        </div>
        
        <div id="tooltip"></div>
    </div>
    
    <script>
        const data = {
            id: 'root',
            name: "Informatics Core",
            type: 'root',
            children: [
                {
                    id: 'comp',
                    name: "Computational Thinking",
                    color: "#c4541a",
                    type: 'pillar',
                    description: "Construct network-based, distributed information systems",
                    children: [
                        {
                            id: 'comp-reason',
                            name: "Reason Logically",
                            color: "#d97706",
                            type: 'category',
                            outcomes: [
                                "Translate arguments into formal language",
                                "Manipulate mathematical objects",
                                "Recognize equivalence between structures",
                                "Decompose problems into simpler structures",
                                "Apply data-driven approaches"
                            ]
                        },
                        {
                            id: 'comp-data',
                            name: "Curate Data",
                            color: "#d97706",
                            type: 'category',
                            outcomes: [
                                "Apply visual methods for complex structures",
                                "Recognize and use basic data structures",
                                "Construct data models of systems",
                                "Evaluate data quality",
                                "Convert data into knowledge",
                                "Manage data securely"
                            ]
                        },
                        {
                            id: 'comp-algo',
                            name: "Apply Algorithms",
                            color: "#d97706",
                            type: 'category',
                            outcomes: [
                                "Translate strategies into algorithms",
                                "Apply graph theory to solve problems",
                                "Integrate algorithms into complex ones",
                                "Research new problem-solving strategies",
                                "Address security concerns"
                            ]
                        },
                        {
                            id: 'comp-impl',
                            name: "Effectively Implement",
                            color: "#d97706",
                            type: 'category',
                            outcomes: [
                                "Apply basic programming structures",
                                "Translate algorithms into code",
                                "Construct distributed systems",
                                "Research new software tools",
                                "Implement security solutions",
                                "Evaluate solution effectiveness"
                            ]
                        }
                    ]
                },
                {
                    id: 'socio',
                    name: "Sociotechnical Thinking",
                    color: "#2d5a27",
                    type: 'pillar',
                    description: "Evaluate and construct solutions from a human(e) perspective",
                    children: [
                        {
                            id: 'socio-ethics',
                            name: "Ethical Sensibility",
                            color: "#4a9e3f",
                            type: 'category',
                            outcomes: [
                                "Formulate and articulate ideas",
                                "Recognize assumptions and biases",
                                "Weigh connections between actors",
                                "Consider diversity and responsibility",
                                "Contribute to human well-being"
                            ]
                        },
                        {
                            id: 'socio-analyze',
                            name: "Analyze Solutions",
                            color: "#4a9e3f",
                            type: 'category',
                            outcomes: [
                                "Identify stakeholders",
                                "Identify values at stake",
                                "Discuss diverse perspectives",
                                "Explain technical and social processes",
                                "Assess technological affordances",
                                "Evaluate power dynamics"
                            ]
                        },
                        {
                            id: 'socio-create',
                            name: "Create Solutions",
                            color: "#4a9e3f",
                            type: 'category',
                            outcomes: [
                                "Engage imagination for possibilities",
                                "Collaborate with diverse teams",
                                "Propose harm-reducing solutions",
                                "Communicate with stakeholders",
                                "Make values-based decisions",
                                "Assess policy and governance"
                            ]
                        }
                    ]
                },
                {
                    id: 'design',
                    name: "Design Thinking",
                    color: "#1d4ed8",
                    type: 'pillar',
                    description: "Complete interaction design projects independently",
                    children: [
                        {
                            id: 'design-research',
                            name: "Research",
                            color: "#3b82f6",
                            type: 'category',
                            outcomes: [
                                "Classify HCI research methods",
                                "Execute ethical research",
                                "Deconstruct and reframe problems",
                                "Identify design opportunities",
                                "Use design thinking process",
                                "Translate research to prototypes"
                            ]
                        },
                        {
                            id: 'design-design',
                            name: "Design",
                            color: "#3b82f6",
                            type: 'category',
                            outcomes: [
                                "Select appropriate methods",
                                "Design with HCI techniques",
                                "Generate user personas",
                                "Develop proof-of-concept",
                                "Produce interactive prototypes"
                            ]
                        },
                        {
                            id: 'design-eval',
                            name: "Evaluate",
                            color: "#3b82f6",
                            type: 'category',
                            outcomes: [
                                "Evaluate with feedback",
                                "Critique designs",
                                "Summarize research insights",
                                "Generate recommendations",
                                "Create improved designs"
                            ]
                        },
                        {
                            id: 'design-dissem',
                            name: "Disseminate",
                            color: "#3b82f6",
                            type: 'category',
                            outcomes: [
                                "Create design portfolio",
                                "Generate documentation",
                                "Design presentations",
                                "Present research posters"
                            ]
                        },
                        {
                            id: 'design-collab',
                            name: "Collaborate",
                            color: "#3b82f6",
                            type: 'category',
                            outcomes: [
                                "Work in peer teams",
                                "Understand project roles",
                                "Judge contributions"
                            ]
                        }
                    ]
                }
            ]
        };

     
     let nodes = [];
    let links = [];
    let simulation;
    let expandedNodes = new Set(['root']);
    let pinnedNodes = new Set();

    const svg = d3.select("#svg");
    const width = window.innerWidth;
    const height = window.innerHeight;
    const tooltip = d3.select("#tooltip");

    // Add zoomable group
    const zoomGroup = svg.append("g");
    const linkGroup = zoomGroup.append("g").attr("class", "links");
    const nodeGroup = zoomGroup.append("g").attr("class", "nodes");

    svg.call(
        d3.zoom()
            .scaleExtent([0.3, 3])
            .on("zoom", (event) => {
                zoomGroup.attr("transform", event.transform);
            })
    );

    function flattenData(node, parent = null, level = 0) {
        const result = { nodes: [], links: [] };

        const nodeData = {
            ...node,
            level,
            parent,
            pinned: false,
            expanded: expandedNodes.has(node.id)
        };
        result.nodes.push(nodeData);

        if (parent) {
            result.links.push({ source: parent.id, target: node.id, type: 'parent' });
        }

        if (expandedNodes.has(node.id) && node.children) {
            node.children.forEach(child => {
                const childData = flattenData(child, node, level + 1);
                childData.nodes.forEach(c => {
                    if (!c.x || !c.y) {   // if new
                        c.x = node.x;
                        c.y = node.y;
                    }
                });
                result.nodes.push(...childData.nodes);
                result.links.push(...childData.links);
            });
        }

       
        if (expandedNodes.has(node.id) && node.outcomes && node.type === 'category') {
            node.outcomes.forEach((outcome, i) => {
                const outcomeNode = {
                    id: `${node.id}-outcome-${i}`,
                    name: outcome,
                    type: 'outcome',
                    parent: node,
                    level: level + 1,
                    color: d3.color(node.color).brighter(1.5),
                    pinned: false,
                    x: node.x,   // initialize at parent’s position
                    y: node.y
                };
                result.nodes.push(outcomeNode);
                result.links.push({ source: node.id, target: outcomeNode.id, type: 'outcome' });
            });
        }

        return result;
    }

    function initSimulation() {
        const flatData = flattenData(data);
        nodes = flatData.nodes;
        links = flatData.links;

        simulation = d3.forceSimulation(nodes)
            .velocityDecay(0.4)
            .alphaDecay(0.03)
            .force("link", d3.forceLink(links)
                .id(d => d.id)
                .distance(d => {
                    if (d.type === 'outcome') return 80;
                    if (d.source.level === 0) return 150;
                    if (d.source.level === 1) return 120;
                    return 100;
                })
                .strength(0.5)
            )
            .force("charge", d3.forceManyBody()
                .strength(d => {
                    if (d.type === 'root') return -800;
                    if (d.type === 'pillar') return -600;
                    if (d.type === 'category') return -350;
                    return -150;
                })
            )
            .force("center", d3.forceCenter(width / 2, height / 2).strength(0.05))
            .force("collision", d3.forceCollide()
                .radius(d => {
                    if (d.type === 'root') return 60;
                    if (d.type === 'pillar') return 50;
                    if (d.type === 'category') return 40;
                    return 30;
                })
                .strength(0.7)
            )
            .on("tick", tick);
    }

    
  function updateVisualization() {
    const flatData = flattenData(data);

    // old nodes with coordinates
    const oldNodeMap = new Map(nodes.map(d => [d.id, d]));

    flatData.nodes.forEach(d => {
        const existing = oldNodeMap.get(d.id);

        if (existing) {
            // Preserve old coordinates but dampen velocities for smoother transitions
            d.x = existing.x;
            d.y = existing.y;
            d.vx = (existing.vx || 0) * 0.3;
            d.vy = (existing.vy || 0) * 0.3;
            d.pinned = existing.pinned;
            if (d.pinned) {
                d.fx = existing.fx;
                d.fy = existing.fy;
            }
        } else if (d.parent) {
            // New node → spawn at parent with slight random offset so they fan out gently
            const parentExisting = oldNodeMap.get(d.parent.id);
            if (parentExisting) {
                const angle = Math.random() * Math.PI * 2;
                const spread = 15 + Math.random() * 15;
                d.x = parentExisting.x + Math.cos(angle) * spread;
                d.y = parentExisting.y + Math.sin(angle) * spread;
            }
            d.vx = 0;
            d.vy = 0;
        }
    });

    nodes = flatData.nodes;
    links = flatData.links;

    simulation.nodes(nodes);
    simulation.force("link").links(links);
    simulation.alpha(0.35).restart(); // gentle restart for smooth expansion

    renderVisualization();
}

    function renderVisualization() {
    const link = linkGroup.selectAll(".link")
        .data(links, d => `${d.source.id}-${d.target.id}`);

    link.exit().transition().duration(300).style("opacity", 0).remove();
    link.enter().append("line")
        .attr("class", d => `link ${d.type}`)
        .style("opacity", 0)
        .transition().duration(300).style("opacity", 1);

    const node = nodeGroup.selectAll(".node-group")
        .data(nodes, d => d.id);

    node.exit().transition().duration(300).ease(d3.easeCubicIn)
        .style("opacity", 0).remove();

    const nodeEnter = node.enter().append("g")
        .attr("class", "node-group")
        .style("opacity", 0)
        .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended)
        );

    // Fade in new nodes
    nodeEnter.transition().duration(400).ease(d3.easeCubicOut)
        .style("opacity", 1);

    // Circle nodes (root, pillar, category)
    nodeEnter.filter(d => d.type !== 'outcome')
        .append("circle")
        .attr("class", "node")
        .attr("r", d => {
            if (d.type === 'root') return 50;
            if (d.type === 'pillar') return 40;
            if (d.type === 'category') return 35;
            return 25;
        })
        .attr("fill", d => d.color || "#d97706");

    // Outcome nodes (rectangles)
    nodeEnter.filter(d => d.type === 'outcome')
        .append("rect")
        .attr("class", "node outcome-node")
        .attr("width", d => Math.max(d.name.length * 6, 80))
        .attr("height", 24)
        .attr("x", d => -Math.max(d.name.length * 6, 80) / 2)
        .attr("y", -12)
        .attr("fill", "rgba(245,240,232,0.06)")
        .attr("stroke", d => d3.color(d.color).darker(0.5));

    // Labels
    nodeEnter.append("text")
        .attr("class", d => d.type === 'outcome' ? "outcome-text" : "node-text")
        .attr("dy", ".35em")
        .text(d => d.name.length > 45 ? d.name.substring(0, 42) + '...' : d.name);

    // Expand/collapse indicator
    nodeEnter.filter(d => (d.children && d.children.length > 0) || (d.outcomes && d.outcomes.length > 0))
        .append("text")
        .attr("class", "expand-indicator")
        .attr("x", d => d.type === 'root' ? 35 : (d.type === 'pillar' ? 28 : 25))
        .attr("y", d => d.type === 'root' ? -35 : (d.type === 'pillar' ? -28 : -25))
        .text(d => expandedNodes.has(d.id) ? '−' : '+');

    // === Event handlers ===

    // Left click → expand/collapse
    nodeEnter.merge(node)
        .on("click", function(event, d) {
            if (d.type === 'outcome') return; // outcomes can't expand
            event.stopPropagation();
            if (expandedNodes.has(d.id)) {
                expandedNodes.delete(d.id);
            } else {
                expandedNodes.add(d.id);
            }
            updateVisualization();
        })
        // Right click → pin/unpin
        .on("contextmenu", function(event, d) {
            event.preventDefault();
            if (d.pinned) {
                d.fx = null;
                d.fy = null;
                d.pinned = false;
                pinnedNodes.delete(d.id);
            } else {
                d.fx = d.x;
                d.fy = d.y;
                d.pinned = true;
                pinnedNodes.add(d.id);
            }
            renderVisualization();
        })
        // Tooltip on hover — delayed to avoid clutter
        .on("mouseenter", function(event, d) {
            // Only show tooltip for nodes with descriptions or outcomes
            if (!d.description && !(d.outcomes && d.outcomes.length > 0) && d.type !== 'outcome') return;

            let content = `<strong>${d.name}</strong>`;
            if (d.description) content += `<br>${d.description}`;
            if (d.type === 'outcome') {
                content = `<strong>Learning Outcome</strong><br>${d.name}`;
            }
            // Don't list all outcomes in tooltip — they're visible as child nodes
            tooltip.html(content);
            clearTimeout(window._tooltipTimer);
            window._tooltipTimer = setTimeout(() => {
                tooltip.classed("show", true);
            }, 500);
        })
        .on("mousemove", function(event) {
            tooltip.style("left", Math.min(event.pageX + 15, window.innerWidth - 320) + "px")
                   .style("top", (event.pageY - 40) + "px");
        })
        .on("mouseleave", () => {
            clearTimeout(window._tooltipTimer);
            tooltip.classed("show", false);
        });

    // Update classes and expand indicators
    nodeEnter.merge(node).select(".node")
        .attr("class", d => {
            let classes = "node";
            if (d.pinned) classes += " pinned";
            if (d.expanded) classes += " expanded";
            return classes;
        });

    nodeEnter.merge(node).select(".expand-indicator")
        .text(d => expandedNodes.has(d.id) ? '−' : '+')
        .style("opacity", d => ((d.children && d.children.length > 0) || (d.outcomes && d.outcomes.length > 0)) ? 1 : 0);
}

    function tick() {
        linkGroup.selectAll(".link")
            .attr("x1", d => d.source.x)
            .attr("y1", d => d.source.y)
            .attr("x2", d => d.target.x)
            .attr("y2", d => d.target.y);

        nodeGroup.selectAll(".node-group")
            .attr("transform", d => `translate(${d.x},${d.y})`);
    }

    function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.15).restart();
        d.fx = d.x;
        d.fy = d.y;
    }
    function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }
    function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
    }

    function expandAll() {
        function expandRecursive(node) {
            expandedNodes.add(node.id);
            if (node.children) {
                node.children.forEach(child => expandRecursive(child));
            }
        }
        expandRecursive(data);
        updateVisualization();
    }

    function collapseAll() {
        expandedNodes.clear();
        expandedNodes.add('root'); // keep root expanded
        updateVisualization();
    }

    function unpinAll() {
        nodes.forEach(d => {
            d.fx = null;
            d.fy = null;
            d.pinned = false;
        });
        pinnedNodes.clear();
        simulation.alpha(0.3).restart();
        renderVisualization();
    }

    function resetSimulation() {
        expandedNodes.clear();
        expandedNodes.add('root');
        pinnedNodes.clear();
        nodes.forEach(d => {
            d.fx = null;
            d.fy = null;
            d.pinned = false;
        });
        updateVisualization();
    }

    initSimulation();
    renderVisualization();
</script>

</body>
</html>